<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://dengyouf.github.io/devops/istio/istio_basics.html">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Istio架构概述 - 运维文档</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../index.html">运维文档</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href="../index.html" class="nav-link">主页</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">云原生</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../k8s/install_docker_k8s.html" class="dropdown-item">基于kubeadm安装kubernetes集群</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">服务网格</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="istio_basics.html" class="dropdown-item active" aria-current="page">Istio架构概述</a>
</li>
                                    
<li>
    <a href="traffic.html" class="dropdown-item">Istio流量治理</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">运行时</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../cri/docker_proxy.html" class="dropdown-item">配置Docker代理</a>
</li>
                                </ul>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle" role="button" data-bs-toggle="dropdown"  aria-expanded="false">Python开发</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../python/advance.html" class="dropdown-item">Python进阶</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../k8s/install_docker_k8s.html" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="traffic.html" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/dengyouf/devops/edit/master/docs/istio/istio_basics.md" class="nav-link"><i class="fa-brands fa-github"></i> Edit on GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#istio" class="nav-link">Istio 架构概述</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#istio_1" class="nav-link">Istio 系统架构</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#istio_2" class="nav-link">快速部署Istio</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#istioctl" class="nav-link">Istioctl 命令</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#kiali" class="nav-link">开放Kiali到集群外部</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="istio">Istio 架构概述<a class="headerlink" href="#istio" title="Permanent link">&para;</a></h1>
<p>Istio是一个开源的独立服务网格，是Envoy Data Plane的控制平面实现，可为用户成功运行分布式微服务架构提供所需的基础设施。Istio 服务网格逻辑上分为数据平面和控制平面。</p>
<ul>
<li>数据平面：服务网格应用程序中管理实例之间的网络流量的部分，以Sidecar的形式与服务进程运行在一起</li>
<li>控制平面：生成和部署控制数据平面行为的相关配置，主要由Pilot、Mixer、Citadel 和Galley四个组件组成</li>
<li>API接口</li>
<li>命令行界面</li>
<li>用于管理应用程序的图形用户界面</li>
</ul>
<p><img alt="img.png" src="img.png" /></p>
<h2 id="istio_1">Istio 系统架构<a class="headerlink" href="#istio_1" title="Permanent link">&para;</a></h2>
<p><img alt="img_1.png" src="img_1.png" /></p>
<table>
<thead>
<tr>
<th></th>
<th>组件</th>
<th>程序文件</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>控制平面</td>
<td>Pilot</td>
<td>istio-pilot</td>
<td>管理和配置部署在Istio服务网格中的所有Envoy代理实例</td>
</tr>
<tr>
<td></td>
<td>Mixer</td>
<td>istio-telemetry <br> istio-policy</td>
<td>负责收集遥测数据<br>负责执行访问策略和管理配额</td>
</tr>
<tr>
<td></td>
<td>Citadel</td>
<td></td>
<td>负责服务的私钥和数字证书管理，用于提供自动生成、分发、轮换及撤销私钥和数据证书的功能</td>
</tr>
<tr>
<td></td>
<td>Citadel</td>
<td></td>
<td>负责服务的私钥和数字证书管理，用于提供自动生成、分发、轮换及撤销私钥和数据证书的功能</td>
</tr>
<tr>
<td></td>
<td>Galley</td>
<td></td>
<td>负责向Istio控制平面的其它组件提供支撑功能，它核验进入网格的配置信息的格式和内容的正确性，并将这些配置信息提供给Pilot和Mixer</td>
</tr>
</tbody>
</table>
<blockquote>
<p>这是老版本微架构，新版本 使用 istiod 单体程序实现上述功能</p>
</blockquote>
<p><img alt="img_3.png" src="img_3.png" /></p>
<ul>
<li><strong>Ingress Gateways</strong>: 反向代理，用于将Istio功能（例如，监控和路由规则）应用于进入服务网格的流量</li>
<li><strong>Engress Gateways</strong>：正向代理，代理应用流量访问网格内其他应用</li>
<li><strong>Istiod</strong>：提供服务发现、配置和证书管理</li>
</ul>
<p>Istio的所有路由规则和控制策略都基于Kubernetes CRD实现，于是，其各种配置策略的定义也都保存于kube-apiserver后端的存储etcd中；
- kube-apiserver也就是Istio的APIServer
- Galley负责从kube-apiserver加载配置并进行分发</p>
<p>Istio提供了大量的CRD，它们大体可分为如下几类:</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>实现组件</th>
<th>资源</th>
<th>功能</th>
</tr>
</thead>
<tbody>
<tr>
<td>Network</td>
<td>Pilot</td>
<td>VirtualService<br>DestinationRule<br>Gateway<br>ServiceEntry<br>EnvoyFilte</td>
<td>实现流量治理</td>
</tr>
<tr>
<td>Authentication</td>
<td>Citadel</td>
<td>Policy<br>MeshPolicy</td>
<td>实现策略认证</td>
</tr>
<tr>
<td>Config</td>
<td>Mixer</td>
<td>httpapispecbindings.config.istio.io<br>httpapispecs.config.istio.io</td>
<td>实现Mixer的各种配置需求</td>
</tr>
</tbody>
</table>
<h2 id="istio_2">快速部署Istio<a class="headerlink" href="#istio_2" title="Permanent link">&para;</a></h2>
<blockquote>
<p>前提：准备好kubernetes集群</p>
</blockquote>
<ul>
<li>kubertes: v1.23.5</li>
<li>
<p>istio: v1.12.1</p>
</li>
<li>
<p>下载istioctl及相关的安装文件和示例文件</p>
</li>
</ul>
<pre><code class="language-shell">~# wget https://github.com/istio/istio/releases/download/1.12.1/istio-1.12.1-linux-amd64.tar.gz
~# tar -xf istio-1.12.1-linux-amd64.tar.gz  -C /usr/local/
~# ln -sv /usr/local/istio-1.12.1/ /usr/local/istio

~#  cp /usr/local/istio/bin/istioctl /usr/bin/
~# istioctl version
no running Istio pods in &quot;istio-system&quot;
1.12.1
</code></pre>
<table>
<thead>
<tr>
<th>内置配置档案</th>
<th>说明</th>
<th>推荐使用</th>
<th>istio-egressgateway</th>
<th>istio-ingressgateway</th>
<th>istiod</th>
</tr>
</thead>
<tbody>
<tr>
<td>default</td>
<td>根据IstioOperator API的默认设置启用相关的组件，适用于生产环境</td>
<td>✅</td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>demo</td>
<td>会部署较多的组件，旨在演示istio的功能，适用于运行BookInfo一类的应用程序</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
<td>✅</td>
</tr>
<tr>
<td>minimal</td>
<td>类似于default profile，但仅部署控制平台组件</td>
<td></td>
<td></td>
<td></td>
<td>✅</td>
</tr>
<tr>
<td>remote</td>
<td>用于配置共享Control Plance的多集群环境</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>empty</td>
<td>不部署任何组件，同在帮助用户在自定义profile是生成基础的配置信息</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>preview</td>
<td>包含预览性配置的profile，用于探索istio新功能，但不保证稳定性、安全性和性能</td>
<td>❗️</td>
<td></td>
<td>✅</td>
<td>✅</td>
</tr>
</tbody>
</table>
<ul>
<li>查看内建 profile</li>
</ul>
<pre><code class="language-shell">~# istioctl profile list
Istio configuration profiles:
    default
    demo
    empty
    external
    minimal
    openshift
    preview
    remote
</code></pre>
<ul>
<li>查看某profile详细信息</li>
</ul>
<pre><code class="language-shell">~# istioctl profile dump demo
</code></pre>
<ul>
<li>安装istio控制平面</li>
</ul>
<pre><code class="language-shell">~# istioctl install --set profile=demo -y
✔ Istio core installed                                                                                                                                                                       
✔ Istiod installed                                                                                                                                                                           
✔ Egress gateways installed                                                                                                                                                                  
✔ Ingress gateways installed                                                                                                                                                                 
✔ Installation complete                                                                                                                                                                      Making this installation the default for injection and validation.

Thank you for installing Istio 1.12.  Please take a few minutes to tell us about your install/upgrade experience!  https://forms.gle/FegQbc9UvePd4Z9z7

~# kubectl  get pod -n istio-system -o wide
NAME                                    READY   STATUS    RESTARTS   AGE     IP            NODE           NOMINATED NODE   READINESS GATES
istio-egressgateway-65bdddf685-6fk64    1/1     Running   0          117s    10.244.3.15   k8s-worker03   &lt;none&gt;           &lt;none&gt;
istio-ingressgateway-7b545cdbc7-cmpx4   1/1     Running   0          117s    10.244.1.14   k8s-worker01   &lt;none&gt;           &lt;none&gt;
istiod-864977fd6c-lf7hr                 1/1     Running   0          2m59s   10.244.3.14   k8s-worker03   &lt;none&gt;           &lt;none&gt;```
</code></pre>
<ul>
<li>部署addons</li>
</ul>
<pre><code class="language-shell">~# cd /usr/local/istio/             
/usr/local/istio# kubectl  apply -f samples/addons/
/usr/local/istio# kubectl  get pod -n istio-system -w
NAME                                    READY   STATUS    RESTARTS   AGE
grafana-5fb899f96-7q7cq                 1/1     Running   0          4m5s
istio-egressgateway-65bdddf685-6fk64    1/1     Running   0          12m
istio-ingressgateway-7b545cdbc7-cmpx4   1/1     Running   0          12m
istiod-864977fd6c-lf7hr                 1/1     Running   0          13m
jaeger-d7849fb76-5xql5                  1/1     Running   0          4m5s
kiali-c9d6f75d5-p6tm5                   1/1     Running   0          4m5s
prometheus-d7df8c957-r95fw              2/2     Running   0          4m4s
</code></pre>
<ul>
<li>标记名称空间自动注入sidercar</li>
</ul>
<pre><code class="language-shell">~# kubectl label namespace default istio-injection=enabled
~# kubectl  create deployment demoapp --image=ikubernetes/demoapp:v1.0 --replicas=3
deployment.apps/demoapp created
~# kubectl  get pod  -owide
NAME                       READY   STATUS    RESTARTS   AGE     IP            NODE           NOMINATED NODE   READINESS GATES
demoapp-5748b7ccfc-g96k7   2/2     Running   0          2m49s   10.244.1.18   k8s-worker01   &lt;none&gt;           &lt;none&gt;
demoapp-5748b7ccfc-kzjg6   2/2     Running   0          2m49s   10.244.2.17   k8s-worker02   &lt;none&gt;           &lt;none&gt;
demoapp-5748b7ccfc-s947x   2/2     Running   0          2m49s   10.244.3.20   k8s-worker03   &lt;none&gt;           &lt;none&gt;

~# kubectl  exec -it demoapp-5748b7ccfc-s947x -- curl localhost:15000/listeners
750a3fbc-694b-4573-a86b-5a7d2e5b5075::0.0.0.0:15090
914ef458-da0d-49c4-8b30-11e7de70fd11::0.0.0.0:15021
10.101.188.140_443::10.101.188.140:443
10.106.26.93_443::10.106.26.93:443
10.106.26.93_31400::10.106.26.93:31400
10.96.0.1_443::10.96.0.1:443
10.96.0.10_53::10.96.0.10:53
10.101.188.140_15012::10.101.188.140:15012
10.100.191.210_443::10.100.191.210:443
10.106.26.93_15443::10.106.26.93:15443
0.0.0.0_15014::0.0.0.0:15014
10.100.9.63_14250::10.100.9.63:14250
10.99.69.60_3000::10.99.69.60:3000
10.100.9.63_14268::10.100.9.63:14268
0.0.0.0_20001::0.0.0.0:20001
10.98.71.107_80::10.98.71.107:80
0.0.0.0_15010::0.0.0.0:15010
10.106.26.93_15021::10.106.26.93:15021
0.0.0.0_80::0.0.0.0:80
0.0.0.0_9411::0.0.0.0:9411
0.0.0.0_9090::0.0.0.0:9090
10.96.0.10_9153::10.96.0.10:9153
0.0.0.0_16685::0.0.0.0:16685
virtualOutbound::0.0.0.0:15001
virtualInbound::0.0.0.0:15006

~# kubectl  exec -it demoapp-5748b7ccfc-s947x -- curl localhost:15000/clusters
</code></pre>
<ul>
<li>卸载Istio</li>
</ul>
<pre><code class="language-shell">kubectl delete -f samples/addons
istioctl x uninstall -y --purge
kubectl label namespace default istio-injection-
kubectl delete namespace istio-system
</code></pre>
<h2 id="istioctl">Istioctl 命令<a class="headerlink" href="#istioctl" title="Permanent link">&para;</a></h2>
<ul>
<li>查看配置下发的状态</li>
</ul>
<pre><code class="language-shell">istioctl proxy-status [&lt;type&gt;/]&lt;name&gt;[.&lt;namespace&gt;] [flags]
</code></pre>
<pre><code class="language-shell">~# istioctl proxy-status
NAME                                                   CDS        LDS        EDS        RDS          ISTIOD                      VERSION
demoapp-5748b7ccfc-g96k7.default                       SYNCED     SYNCED     SYNCED     SYNCED       istiod-864977fd6c-lf7hr     1.12.1
demoapp-5748b7ccfc-kzjg6.default                       SYNCED     SYNCED     SYNCED     SYNCED       istiod-864977fd6c-lf7hr     1.12.1
demoapp-5748b7ccfc-s947x.default                       SYNCED     SYNCED     SYNCED     SYNCED       istiod-864977fd6c-lf7hr     1.12.1
istio-egressgateway-65bdddf685-6fk64.istio-system      SYNCED     SYNCED     SYNCED     NOT SENT     istiod-864977fd6c-lf7hr     1.12.1
istio-ingressgateway-7b545cdbc7-cmpx4.istio-system     SYNCED     SYNCED     SYNCED     NOT SENT     istiod-864977fd6c-lf7hr     1.12.1
root@k8s-master01:~# 
</code></pre>
<ul>
<li>查看配置信息</li>
</ul>
<pre><code class="language-shell">istioctl proxy-config &lt;clusters|listeners|routes|endpoints|bootstrap|log|secret&gt; &lt;pod-name[.namespace]&gt;
</code></pre>
<pre><code class="language-shell">~# istioctl proxy-config clusters demoapp-5748b7ccfc-g96k7.default --port 80
SERVICE FQDN                                            PORT     SUBSET     DIRECTION     TYPE     DESTINATION RULE
istio-egressgateway.istio-system.svc.cluster.local      80       -          outbound      EDS      
istio-ingressgateway.istio-system.svc.cluster.local     80       -          outbound      EDS      
myapp.default.svc.cluster.local                         80       -          outbound      EDS      
tracing.istio-system.svc.cluster.local                  80       -          outbound      EDS  
</code></pre>
<h2 id="kiali">开放Kiali到集群外部<a class="headerlink" href="#kiali" title="Permanent link">&para;</a></h2>
<pre><code class="language-shell">~# kubectl  get svc/kiali  -n istio-system
NAME    TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)              AGE
kiali   ClusterIP   10.110.75.11   &lt;none&gt;        20001/TCP,9090/TCP   3h18m
~# kubectl  get pod  -n istio-system|grep kiali
kiali-c9d6f75d5-p6tm5                   1/1     Running   0          3h19m
</code></pre>
<h3 id="externalip-istio-ingressgateway">ExternalIP 的方式暴漏 istio-ingressgateway<a class="headerlink" href="#externalip-istio-ingressgateway" title="Permanent link">&para;</a></h3>
<ul>
<li>在集群内某一网卡上添加额外的地址用来提供External IP</li>
</ul>
<pre><code class="language-shell">~# cat /etc/netplan/00-installer-config.yaml
# This is the network config written by 'subiquity'
network:
  ethernets:
    eth1:
      addresses:
      - 172.16.192.100/16
    eth0:
      addresses:
      - 172.16.192.31/16
      gateway4: 172.16.192.2
      nameservers:
        addresses:
        - 223.5.5.5
        search: []
  version: 2
 ```
- 配置ExternalIP到 IngressGateway
```shell
~# kubectl edit svc/istio-ingressgateway -n istio-system
...
  externalTrafficPolicy: Cluster
  externalIPs:
  - 172.16.192.100
~# kubectl get  svc/istio-ingressgateway -n istio-system
NAME                   TYPE           CLUSTER-IP     EXTERNAL-IP      PORT(S)                                                                      AGE
istio-ingressgateway   LoadBalancer   10.106.26.93   172.16.192.100   15021:32234/TCP,80:30135/TCP,443:30693/TCP,31400:32617/TCP,15443:30032/TCP   4h17m
</code></pre>
<h3 id="gateway">定义Gateway<a class="headerlink" href="#gateway" title="Permanent link">&para;</a></h3>
<pre><code class="language-shell">cat  &gt; kiali-gateway.yaml &lt;&lt; EOF
---
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: kiali-gateway
  namespace: istio-system
spec:
  selector:
    app: istio-ingressgateway
  servers:
  - port:
      number: 80
      name: http-kiali
      protocol: HTTP
    hosts:
    - &quot;kiali.linux.io&quot;
EOF

kubectl apply -f  kiali-gateway.yaml

# ⚠️  对80端口自动转换成8080端口
~# istioctl proxy-config route $(kubectl  get pods -l app=istio-ingressgateway -n istio-system -o jsonpath={.items[0].metadata.name}) -n istio-system
NAME          DOMAINS            MATCH                  VIRTUAL SERVICE
http.8080     kiali.linux.io     /*                     kiali-virtualservice.istio-system
              *                  /healthz/ready*        
              *                  /stats/prometheus*  
</code></pre>
<h3 id="virtualservice">定义VirtualService<a class="headerlink" href="#virtualservice" title="Permanent link">&para;</a></h3>
<pre><code class="language-shell">cat  &gt; kiali-virtualservice.yaml &lt;&lt; EOF
---
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: kiali-virtualservice
  namespace: istio-system
spec:
  hosts:
  - &quot;kiali.linux.io&quot;
  gateways:
  - kiali-gateway
  http:
  - match:
    - uri:
        prefix: /
    route:
    - destination:
        host: kiali
        port:
          number: 20001
EOF

kubectl apply -f  kiali-virtualservice.yaml 
#  如果不定义 destinationrule， DESTINATION RULE为空
~# istioctl proxy-config cluster $(kubectl  get pods -l app=istio-ingressgateway -n istio-system -o jsonpath={.items[0].metadata.name}) -n istio-system|grep 20001
kiali.istio-system.svc.cluster.local                    20001     -          outbound      EDS 
</code></pre>
<h3 id="destinationrule">定义DestinationRule<a class="headerlink" href="#destinationrule" title="Permanent link">&para;</a></h3>
<p>可选</p>
<pre><code class="language-shell">cat  &gt; kiali-destinationrule.yaml &lt;&lt; EOF
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: kiali
  namespace: istio-system
spec:
  host: kiali
  trafficPolicy:
    tls:
      mode: DISABLE
EOF
kubectl apply -f kiali-destinationrule.yaml
# 定义destinationrule， DESTINATION RULE不为空
~# istioctl proxy-config cluster $(kubectl  get pods -l app=istio-ingressgateway -n istio-system -o jsonpath={.items[0].metadata.name}) -n istio-system|grep 20001
kiali.istio-system.svc.cluster.local                    20001     -          outbound      EDS            kiali.istio-system
</code></pre>
<pre><code class="language-shell">~# kubectl  get vs -n istio-system
NAME                   GATEWAYS            HOSTS                AGE
kiali-virtualservice   [&quot;kiali-gateway&quot;]   [&quot;kiali.linux.io&quot;]   38m
root@k8s-master01:~# kubectl  get dr -n istio-system
NAME    HOST    AGE
kiali   kiali   3m11s
root@k8s-master01:~# kubectl  get gateway -n istio-system
NAME            AGE
kiali-gateway   40m
</code></pre>
<h3 id="_1">访问<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>添加hosts解析如下</p>
<pre><code class="language-shell">172.26.192.100  kiali.linux.io
</code></pre>
<p><img alt="img_7.png" src="img_7.png" /></p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
